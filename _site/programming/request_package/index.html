<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>02 - Posting to Websites in Python • Tyler Abbot</title>
    
    <meta name="keywords" content="">
    
    
    	<!-- Twitter Cards -->
	<meta name="twitter:title" content="02 - Posting to Websites in Python">
	
	
	
	
	<meta name="twitter:card" content="summary">
	<meta name="twitter:image" content="/images/mandelbrot4.png">
	
	<!-- Open Graph -->
	<meta property="og:locale" content="">
	<meta property="og:type" content="article">
	<meta property="og:title" content="02 - Posting to Websites in Python">
	<meta property="og:description" content="How to login and download files from a website using Python.">
	<meta property="og:url" content="/programming/request_package/">
	<meta property="og:site_name" content="Tyler Abbot">
	<meta property="og:image" content="/images/mandelbrot4.png">


    <link rel="canonical" href="/programming/request_package/">

    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Tyler Abbot Atom Feed">

    <link href="/sitemap.xml" type="application/xml" rel="sitemap" title="Sitemap">
    
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="cleartype" content="on">

    <link rel="stylesheet" href="/css/main.css">
    <!-- HTML5 Shiv and Media Query Support for IE -->
    <!--[if lt IE 9]>
      <script src="/js/vendor/html5shiv.min.js"></script>
      <script src="/js/vendor/respond.min.js"></script>
    <![endif]-->

  </head>

  <body id="js-body">
    <!--[if lt IE 9]><div class="upgrade notice-warning"><strong>Your browser is quite old!</strong> Why not <a href="http://whatbrowser.org/">upgrade to a newer one</a> to better enjoy this site?</div><![endif]-->

    <header id="masthead">
  <div class="inner-wrap">
    <a href="/" class="site-title">Tyler Abbot</a>
    <nav role="navigation" class="menu top-menu">
        <ul class="menu-item">
	<li class="home"><a href="/">Tyler Abbot</a></li>
	
    
        
    
    <li><a href="/about/" >About</a></li>
  
    
        
    
    <li><a href="/cv/" >CV</a></li>
  
    
        
    
    <li><a href="/teaching/" >Teaching</a></li>
  
    
        
    
    <li><a href="/research/" >Research</a></li>
  
    
        
    
    <li><a href="/programming/" >Programming</a></li>
  
    
        
    
    <li><a href="/links/" >Links</a></li>
  
</ul>
    </nav>
  </div><!-- /.inner-wrap -->
</header><!-- /.masthead -->

<!--    <nav role="navigation" id="js-menu" class="sliding-menu-content">
  <h5>Tyler Abbot <span>Table of Contents</span></h5>
  <ul class="menu-item">
    <li>
      <a href="/about/">
        <img src="/images/papers1.png" alt="teaser" class="teaser">
        <div class="title">About</div>
        <p class="excerpt">A bit about me.</p>
      </a>
    </li><li>
      <a href="/cv/">
        <img src="/images/papers2.png" alt="teaser" class="teaser">
        <div class="title">CV</div>
        <p class="excerpt">My CV.</p>
      </a>
    </li><li>
      <a href="/teaching/">
        <img src="/images/papers3.png" alt="teaser" class="teaser">
        <div class="title">Teaching</div>
        <p class="excerpt">Courses I've taught or helped to teach.</p>
      </a>
    </li><li>
      <a href="/research/">
        <img src="/images/papers4.png" alt="teaser" class="teaser">
        <div class="title">Research</div>
        <p class="excerpt">Things I study.</p>
      </a>
    </li><li>
      <a href="/programming/">
        <img src="/images/papers5.png" alt="teaser" class="teaser">
        <div class="title">Programming</div>
        <p class="excerpt">Programming I do.</p>
      </a>
    </li><li>
      <a href="/links/">
        <img src="/images/papers5.png" alt="teaser" class="teaser">
        <div class="title">Links</div>
        <p class="excerpt">Sites I like.</p>
      </a>
    </li>
  </ul>
</nav>
<button type="button" id="js-menu-trigger" class="sliding-menu-button lines-button x2" role="button" aria-label="Toggle Navigation">
  <span class="nav-lines"></span>
</button>

<div id="js-menu-screen" class="menu-screen"></div>
 -->

    <div id="page-wrapper">
      <div id="main" role="main">
	<article class="wrap" itemscope itemtype="http://schema.org/Article">
		
		
  <nav class="breadcrumbs">
    <span itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
      <a href="" itemprop="url">
        <span itemprop="title">Home</span>
      </a> › 
    <span itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
      <a href="/programming/" itemprop="url">
        <span itemprop="title">programming</span>
      </a> › 
    <span itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
      <a href="/programming/python.html" itemprop="url">
        <span itemprop="title">python</span>
      </a>
    </span>
  </nav><!-- /.breadcrumbs -->

    <!--  <a href="/programming/" itemprop="url"> -->

		<div class="page-title">
			<h1>02 - Posting to Websites in Python</h1>
		</div>
		<div class="inner-wrap">
			<div id="content" class="page-content" itemprop="articleBody">
				<nav class="toc">
<ul id="markdown-toc">
  <li><a href="#different-methods-to-do-the-same-things">Different Methods to Do the Same things</a></li>
  <li><a href="#requests">Requests</a></li>
  <li><a href="#what-we-are-going-to-do">What We Are Going to Do</a></li>
  <li><a href="#the-initial-get">The Initial Get</a></li>
  <li><a href="#conclusion">Conclusion</a></li>
</ul>

</nav>

<p>For the last couple weeks I’ve been doing some house keeping before going on vacation.  I’m working on a paper using PSID panel data and want to do my work in Python.  The problem is that the PSID data comes in SAS format, with a .txt ASCII file containing the data and a .sas (or .do or .spss) file containing instructions on how to interpret the file.  In order to deal with these files, <a href="https://floswald.github.io/" target="_blank_">Florian Oswald</a> has written an R package to download the data and build a panel.  I’ve been transcribing the package into Python and struggled for several days with posting to the online form in order to login and download data.  This post is about how to do that and what I found to be the easiest solution.</p>

<h2 id="different-methods-to-do-the-same-things">Different Methods to Do the Same things</h2>
<p>The standard for connecting to a website from Python, R, etc., is cURL, a free software library for transferring data through http.  The problem is that in Python the libcurl wrapper is not at all pythonic.  Unless you are familiar with using http you will struggle, as I did, for days trying to get the functions to work.  As usual, though, there is a module to fix that!</p>

<p>The slogan for the <a href="http://docs.python-requests.org/en/latest/" target="_blank_">Requests</a> module is “HTTP for Humans”.  Ah, finally something I can understand!  The module does all of the heavy lifting for you and even anticipates some of your needs.  I encourage you, if you are going to be using it at all often, to get familiar with what the package can do by perusing the read me.  This will also give you a chance to learn about http if you are unfamiliar (as I was).</p>

<h2 id="requests">Requests</h2>
<p>So to get started, let’s see how to make a simple request (this example is taken from the Requests website).  First, import requests (given that you’ve already installed the module):</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">requests</span></code></pre></div>

<p>Requests is object oriented, so you post requests to a webpage and the generated object contains all of the response information you might need.  For example, run</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;https://api.github.com/events&#39;</span><span class="p">)</span></code></pre></div>

<p>The returned <code>r</code> object contains a bunch of methods you can use to retrieve information from the returned html.  For instance <code>r.url</code> will return the associated <code>url</code>, while <code>r.text</code> will return the entire <code>html</code> webpage.  There a ton of methods that are very useful, so I suggest you get familiar by reading the user guide.</p>

<h2 id="what-we-are-going-to-do">What We Are Going to Do</h2>
<p>So, in order to save time and space I’m going to combine two topics here.  We’ll take as a working example posting to the PSID website to login.  If you want to follow along, I suggest you register for an account <a href="http://simba.isr.umich.edu/U/Login.aspx" target="_blank_">here</a>.  The PSID Data Center is what is known as an ASP web application.  That really just refers to the architecture on which the site is built, but it has implicaitons for posting a login to the page.  ASP sites often have different requirements for form fields, or the information they need in order to allow you to login.  Because of this there are two things that you will need to do: scrape and post.</p>

<p>First of all, you must scrape the page.  What does this mean?  To better explain, follow these steps:</p>

<ul>
  <li>First of all, navigate to the PSID login page linked above.</li>
  <li>Right click on the login field (or anywhere for that matter) and click “Inspect Element”.</li>
  <li>Navigate to the network tab and click on the clear button (similar to a <a href="https://www.google.fr/webhp?sourceid=chrome-instant&amp;ion=1&amp;espv=2&amp;ie=UTF-8#q=do%20not%20sign" target="_blank_">“Do Not…”</a> symbol in the states).</li>
  <li>Now login using your username and password.  In the inspect element field you should see a bunch of information appear.  If not, start over because you must have done something wrong.  My screen looks like this:</li>
</ul>

<p><img src="/images/post_screen.png" alt="Screen" /></p>

<ul>
  <li>One of the elements (probably the first) will be <code>Login.aspx</code>.  Click on this and it will pop up a frame with several tabs.  Select <code>Headers</code>.</li>
  <li>Scroll down to <code>Form Data</code></li>
</ul>

<p>You made it!  What you are looking at is a list of the required fields to post a login form on the PSID website.  In order for your program to login you must provide all of this information.  When writing a program to post a form, this is the first thing you should do to find out what fields you need to know.</p>

<p>So, in order to login we’ll follow the following steps:</p>

<ol>
  <li>Post a <code>request</code> to the page to retrieve the <code>html</code>.</li>
  <li>“Scrape” the page to find the required form field values.</li>
  <li>Re-post a <code>request</code> to login.</li>
</ol>

<p>But wait, what is scraping!?  Scraping refers to searching a webpage for key terms.  This is how Google builds its search results (or one of the many steps in what they do).  We don’t actually have to do all the work to do this, as <a href="http://www.crummy.com/software/BeautifulSoup/" target="_blank_">Beautiful Soup</a> is going to do all of it for us.  So let’s get down to business.</p>

<h2 id="the-initial-get">The Initial Get</h2>
<p>Since we’ve already imported requests, the first thing we’ll do is create a <code>requests</code> session object and define the login url:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">c</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
<span class="n">URL</span> <span class="o">=</span> <span class="s">&#39;http://simba.isr.umich.edu/u/login.aspx&#39;</span></code></pre></div>

<p>Now we want to retrieve the <code>html</code> for the page:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">page</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">URL</span><span class="p">)</span></code></pre></div>

<p>Next, use the Beautiful Soup package to scrape the page and define a <code>params</code> dictionary object that contains all of your form variables:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">#Import Beautiful Soup</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>

<span class="c">#Use the beautifulsoup package to scrape for form variables</span>
<span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">page</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
<span class="n">viewstate</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">findAll</span><span class="p">(</span><span class="s">&quot;input&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s">&quot;type&quot;</span><span class="p">:</span> <span class="s">&quot;hidden&quot;</span><span class="p">,</span>
                         <span class="s">&quot;name&quot;</span><span class="p">:</span> <span class="s">&quot;__VIEWSTATE&quot;</span><span class="p">})</span>
<span class="n">radscript</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">findAll</span><span class="p">(</span><span class="s">&quot;input&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s">&quot;type&quot;</span><span class="p">:</span> <span class="s">&quot;hidden&quot;</span><span class="p">,</span>
                         <span class="s">&quot;name&quot;</span><span class="p">:</span> <span class="s">&quot;RadScriptManager1_TSM&quot;</span><span class="p">})</span>
<span class="n">viewstategenerator</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">findAll</span><span class="p">(</span><span class="s">&quot;input&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s">&quot;type&quot;</span><span class="p">:</span> <span class="s">&quot;hidden&quot;</span><span class="p">,</span>
                                  <span class="s">&quot;name&quot;</span><span class="p">:</span> <span class="s">&quot;__VIEWSTATEGENERATOR&quot;</span><span class="p">})</span>
<span class="n">eventvalidation</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">findAll</span><span class="p">(</span><span class="s">&quot;input&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s">&quot;type&quot;</span><span class="p">:</span> <span class="s">&quot;hidden&quot;</span><span class="p">,</span>
                               <span class="s">&quot;name&quot;</span><span class="p">:</span> <span class="s">&quot;__EVENTVALIDATION&quot;</span><span class="p">})</span>
<span class="n">radscript</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">findAll</span><span class="p">(</span><span class="s">&quot;input&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s">&quot;type&quot;</span><span class="p">:</span> <span class="s">&quot;hidden&quot;</span><span class="p">,</span> <span class="s">&quot;name&quot;</span><span class="p">:</span>
                         <span class="s">&quot;RadScriptManager1_TSM&quot;</span><span class="p">})</span>

<span class="c">#Gather form data into a single dictionary</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;RadScriptManager1_TSM&#39;</span><span class="p">:</span> <span class="n">radscript</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;value&#39;</span><span class="p">],</span>
          <span class="s">&#39;__EVENTTARGET&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
          <span class="s">&#39; __EVENTARGUMENT&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
          <span class="s">&#39;__VIEWSTATE&#39;</span><span class="p">:</span> <span class="n">viewstate</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;value&#39;</span><span class="p">],</span>
          <span class="s">&#39;__VIEWSTATEGENERATOR&#39;</span><span class="p">:</span> <span class="n">viewstategenerator</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;value&#39;</span><span class="p">],</span>
          <span class="s">&#39;__EVENTVALIDATION&#39;</span><span class="p">:</span> <span class="n">eventvalidation</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;value&#39;</span><span class="p">],</span>
          <span class="s">&#39;ctl00$ContentPlaceHolder1$Login1$UserName&#39;</span><span class="p">:</span> <span class="n">USERNAME</span><span class="p">,</span>
          <span class="s">&#39;ctl00$ContentPlaceHolder1$Login1$Password&#39;</span><span class="p">:</span> <span class="n">PASSWORD</span><span class="p">,</span>
          <span class="s">&#39;ctl00$ContentPlaceHolder1$Login1$LoginButton&#39;</span><span class="p">:</span> <span class="s">&#39;Log In&#39;</span><span class="p">,</span>
          <span class="s">&#39;ctl00_RadWindowManager1_ClientState&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">}</span></code></pre></div>

<p>You’ll want to replace <code>USERNAME</code> and <code>PASSWORD</code> with your own.  Notice that I left some of the form fields blank.  This is because they are blank whenever I submit this form, but I kept them here in case it is different for others.</p>

<p>Now, post the form:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">c</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">URL</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s">&quot;Referer&quot;</span><span class="p">:</span> <span class="s">&quot;http://psidonline.isr.umich.edu/&quot;</span><span class="p">})</span></code></pre></div>

<p>Here the <code>headers={"Referer": "http://psidonline.isr.umich.edu/"}</code> tells the website that you came from within the site and are not just posting the form directly (which is actually what you are doing, but the site doesn’t seem to like that…).  Now the reason for using the session object should become clear.  <code>c</code> now contains a cookie that you can use to move within the site.  For example, let’s say you wanted to download a the zipped family interview files from 1968.  Then you could simply run the following line:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">data</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;http://simba.isr.umich.edu/Zips/GetFile.aspx?file=1056&#39;</span><span class="p">,</span>
             <span class="n">allow_redirects</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span></code></pre></div>

<p>Now <code>data</code> contains a binary zip file with the data you requested.  You can use the ZipFile module to unzip and save this, but that’s for another post!</p>

<h2 id="conclusion">Conclusion</h2>
<p>Overall, posting to webpages is not something that I or other economists need to do very often.  However, when we do need to do it it is because we need data.  These data files can sometimes be large or there could be many of them.  Using the <code>requests</code> package to automate logging into a database can save us tons of time, as we can let the computer do all of the work for us!  In any case, if you have any comments or questions, please let me know!</p>

				<hr />
				<footer class="page-footer">
					


<div class="author-image">
	<img src="/images/bio-photo2.jpg" alt="Tyler Abbot">
</div><!-- ./author-image -->
<div class="author-content">
	<h3 class="author-name" >Written by <span itemprop="author">Tyler Abbot</span></h3>
	<p class="author-bio">Nerd extraordinaire.</p>
</div><!-- ./author-content -->
					<div class="inline-btn">
	<a class="btn-social twitter" href="https://twitter.com/intent/tweet?text=02%20-%20Posting%20to%20Websites%20in%20Python&amp;url=/programming/request_package/&amp;via=" target="_blank"><i class="fa fa-twitter" aria-hidden="true"></i> Share on Twitter</a>
	<a class="btn-social facebook" href="https://www.facebook.com/sharer/sharer.php?u=/programming/request_package/" target="_blank"><i class="fa fa-facebook" aria-hidden="true"></i> Share on Facebook</a>
	<a class="btn-social google-plus"  href="https://plus.google.com/share?url=/programming/request_package/" target="_blank"><i class="fa fa-google-plus" aria-hidden="true"></i> Share on Google+</a>
</div><!-- /.share-this -->
					<div class="page-meta">
	<p>Updated <time datetime="2015-06-22T10:27:01Z" itemprop="datePublished">June 22, 2015</time></p>
</div><!-- /.page-meta -->
				</footer><!-- /.footer -->
				<aside>
					
				</aside>
			</div><!-- /.content -->
		</div><!-- /.inner-wrap -->
		
	</article><!-- ./wrap -->
</div><!-- /#main -->

      <footer role="contentinfo" id="site-footer">
	<nav role="navigation" class="menu bottom-menu">
		<ul class="menu-item">
		
      
        
      
			<li><a href="" ></a></li>
		
		</ul>
	</nav><!-- /.bottom-menu -->
	<p class="copyright">&#169; 2015 <a href="">Tyler Abbot</a> powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> + <a href="http://mmistakes.github.io/skinny-bones-jekyll/" rel="nofollow">Skinny Bones</a>.</p>
</footer>
    </div>

    <script src="/js/vendor/jquery-1.9.1.min.js"></script>
    <script src="/js/main.js"></script>

  </body>

</html>
